<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Verificaci√≥n LEGACYCREW</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; max-width: 600px; margin: auto; }
    h1 { color: #2E86C1; }
    .error { color: red; }
    .valid { color: green; }
  </style>
</head>
<body>
  <h1>‚úÖ Verificaci√≥n de Constancia</h1>
  <div id="resultado">Cargando...</div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const codigoBuscado = params.get("codigo");

    if (!codigoBuscado) {
      document.getElementById("resultado").innerHTML = "<p class='error'>‚ùå No se proporcion√≥ ning√∫n c√≥digo.</p>";
    } else {
      fetch("REGISTRO%20DE%20CONSTANCIA%20-%20REGISTRO%20DE%20CERTIFICADOS.csv")
        .then(response => response.text())
        .then(data => {
          const filas = data.trim().split("\n").slice(1); // omitir encabezado
          let encontrado = false;

          for (let fila of filas) {
            const columnas = fila.split(",");
            const consecutivo = columnas[1]?.trim(); // columna 2: CONSECUTIVO

            if (consecutivo === codigoBuscado.trim()) {
              const fecha = columnas[0];
              const nombre = columnas[2];
              const curso = columnas[3];
              const link = columnas[4];
              const vigencia = columnas[6];

              document.getElementById("resultado").innerHTML = `
                <p><strong>Nombre:</strong> ${nombre}</p>
                <p><strong>Curso / Evento:</strong> ${curso}</p>
                <p><strong>Fecha de emisi√≥n:</strong> ${fecha}</p>
                <p><strong>Vigencia:</strong> <span class="${vigencia === 'VALIDO' ? 'valid' : 'error'}">${vigencia}</span></p>
                <p><a href="${link}" target="_blank">üìÑ Ver constancia</a></p>
              `;
              encontrado = true;
              break;
            }
          }

          if (!encontrado) {
            document.getElementById("resultado").innerHTML = "<p class='error'>‚ùå C√≥digo no encontrado.</p>";
          }
        })
        .catch(error => {
          document.getElementById("resultado").innerHTML = "<p class='error'>‚ùå Error al cargar los datos.</p>";
        });
    }
  </script>
</body>
</html>
